<!DOCTYPE html>
<html lang="es">
<head>
    <title>Edit Entidad</title>
    <meta charset="UTF-8">
    <meta name="description" content="Pagina de ediciÃ³n de una entidad">
    <meta name="author" content="Alvaro Aviles Redondo - bp0259">
    <meta name="author" content="Jesus Anton Diaz - bp0005">
    <!--- estilos con CSS -->
    <link rel="stylesheet" href="../../styles.css">
    <script src="https://unpkg.com/jquery@1"></script>
</head>
<body onload="Carga()">
<div class="contenedor">
    <div class="cabecera-principal">
        <h1>Anales de la Ciencia - Editar entidad</h1>
    </div>
    <div class="div-volver-editar-entidad">
        <input id="boton-volver" type="button" name="Volver" value="Volver" onclick="Volver()" />
    </div>
    <div id="div_info_usuario">
    </div>
    <div id="div_formulario_editar">
        <form id="form_edit">
            <label for="NombreEntidad">Nombre de la entidad: </label>
            <input id="NombreEntidad" type="text" name="NombreEntidad" placeholder="Nombre de la entidad"/>
            <br><br>
            <label for="BirthDate">BirthDate: </label>
            <input id="BirthDate" type="text" name="BirthDate" placeholder="Format: yyyy-mm-dd"/>
            <br><br>
            <label for="DeathDate">DeathDate: </label>
            <input id="DeathDate" type="text" name="DeathDate" placeholder="Format: yyyy-mm-dd"/>
            <br><br>
            <label for="ImageUrl">ImageUrl: </label>
            <input id="ImageUrl" type="text" name="ImageUrl" placeholder="ImageUrl"/>
            <br><br>
            <label for="WikiUrl">WikiUrl: </label>
            <input id="WikiUrl" type="text" name="WikiUrl" placeholder="WikiUrl"/>
            <br><br>
            <!--<label for="Persons">Persons: </label>
            <input id="Persons" type="text" name="Persons" placeholder="Ej: [3,5,32]"/>
            <br><br>
            <label for="Entities">Entities: </label>
            <input id="Entities" type="text" name="Entities" placeholder="Ej: [3,5,32]"/>
            <br><br>-->
            <input type="button" name="Create Entity" value="Create Entity" onclick="EditEntity()" />
        </form>
    </div>
    <!--<div class="contenido">
    </div>-->
</div>
<script>
    let authHeader = null
    let userName = null
    let userRole = null
    let idEntidad = null

    function Carga(){
        //Recuperamos los datos del querystring del URL
        const urlParams = new URLSearchParams(window.location.search);
        authHeader = urlParams.get('authHeader');
        userName = urlParams.get('userName');
        userRole = urlParams.get('userRole');
        idEntidad = urlParams.get('idEntidad');

        let p = document.createElement("p");
        let text = document.createTextNode("User: " +userName+ " - Role: " +userRole);
        p.appendChild(text);
        document.getElementById("div_info_usuario").appendChild(p);
    }

    function EditEntity(){
        let entidad = null;

        rellenarEntidad();

        function rellenarEntidad(){
            entidad = {
                name: $("#NombreEntidad").val(),
                birthDate: $("#BirthDate").val(),
                deathDate: $("#DeathDate").val(),
                imageUrl: $("#ImageUrl").val(),
                wikiUrl: $("#WikiUrl").val()
                //persons: $("#Persons").val(),
                //entities: $("#Entities").val()
            };
        }

        $.ajax({
            type: "GET",
            url: '/api/v1/entities/'+idEntidad,
            headers: {"Authorization": authHeader},
            // dataType: 'json',
            success: function (data) {
                $.ajax({
                    type: "PUT",
                    url: '/api/v1/entities/'+idEntidad,
                    headers: {"Authorization": authHeader,"if-Match": getEtag()},
                    data:entidad,
                    // dataType: 'json',
                    success: function (data) {
                        location.replace("http://127.0.0.1:8000/webPage/writerSubsystem/writer.html?authHeader=" + authHeader + "&userName=" + userName + "&userRole=" + userRole);
                    }
                })
            }
        });
    }

    function Volver(){
        location.replace("http://127.0.0.1:8000/webPage/writerSubsystem/writer.html?authHeader=" +authHeader+ "&userName=" +userName+ "&userRole=" +userRole);
    }

</script>
</body>
</html>